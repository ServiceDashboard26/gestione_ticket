<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Segnalazione Guasto</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; padding: 20px; color: #333; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 550px; margin: auto; }
        
        .header { border-bottom: 2px solid #28a745; margin-bottom: 20px; padding-bottom: 10px; text-align: center; }
        h2 { color: #28a745; margin: 0; min-height: 1.2em; }
        
        .info-box { background: #e9f7ef; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-size: 15px; border-left: 5px solid #28a745; }
        .info-box div { margin-bottom: 5px; }

        label { font-weight: bold; display: block; margin-bottom: 5px; color: #555; }
        input, textarea { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        input:focus, textarea:focus { border-color: #28a745; outline: none; background-color: #fff; }

        button { width: 100%; background: #28a745; color: white; border: none; padding: 16px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 18px; transition: 0.3s; }
        button:hover { background: #218838; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        
        .footer-note { font-size: 12px; color: #888; text-align: center; margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2 id="main-welcome">Benvenuto</h2>
        <div id="customer-name" style="font-weight: bold; color: #666; margin-top: 5px;">Azienda: <span id="c_display">...</span></div>
    </div>
    
    <div class="info-box">
        <div><strong>Strumento:</strong> <span id="t_val">...</span></div>
        <div><strong>Numero di Serie:</strong> <span id="s_val">...</span></div>
    </div>

    <label for="nome_utente">Il tuo Nome (Referente):</label>
    <input type="text" id="nome_utente" placeholder="Scrivi il tuo nome..." autocomplete="name">

    <label for="tel_utente">Tuo Telefono:</label>
    <input type="tel" id="tel_utente" placeholder="Esempio: +39 340 1234567">

    <label for="descr">Descrizione del problema:</label>
    <textarea id="descr" maxlength="256" rows="4" placeholder="Descrivi brevemente il malfunzionamento..."></textarea>
    
    <button onclick="inviaDati()">INVIA SEGNALAZIONE</button>
    
    <div class="footer-note">I dati verranno registrati nel database dell'assistenza tecnica.</div>
</div>

<script>
    // URL del tuo script Google (Assicurati che sia l'ultimo distribuito)
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxEHjj28dF8AJ3qNFDMChGqgNMCv3wl5PgcM1LC2gltKMNj6uuSzDVfJi1dpIW3tmQAzg/exec';

    // Funzione per leggere i parametri dall'URL (c, t, s)
    function getParam(n) {
        const r = new RegExp('[\?&]' + n + '=([^&#]*)').exec(window.location.href);
        return r ? decodeURIComponent(r[1]) : "N/D";
    }

    const cliente = getParam('c');
    const strumento = getParam('t');
    const seriale = getParam('s');

    window.onload = () => {
        document.getElementById('c_display').innerText = cliente;
        document.getElementById('t_val').innerText = strumento;
        document.getElementById('s_val').innerText = seriale;

        // Effetto dinamico: cambia il titolo mentre l'utente scrive il suo nome
        const inputNome = document.getElementById('nome_utente');
        const titoloBenvenuto = document.getElementById('main-welcome');

        inputNome.addEventListener('input', () => {
            const valore = inputNome.value.trim();
            titoloBenvenuto.innerText = valore ? "Benvenuto, " + valore : "Benvenuto";
        });
    };

    function inviaDati() {
        const nome = document.getElementById('nome_utente').value.trim();
        const tel = document.getElementById('tel_utente').value.trim();
        const d = document.getElementById('descr').value.trim();

        if (!nome || !d) {
            alert("Per favore, inserisci almeno il tuo Nome e una descrizione del problema.");
            return;
        }

        // Creazione parametri per l'invio
        const params = new URLSearchParams();
        params.append('dataOra', new Date().toLocaleString('it-IT'));
        params.append('cliente', cliente);
        params.append('strumento', strumento);
        params.append('seriale', seriale);
        params.append('descrizione', d);
        params.append('nomeUtente', nome);
        params.append('telefonoUtente', tel);

        fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: params })
        .then(() => {
            alert("Grazie " + nome + ", la tua segnalazione è stata inviata correttamente.");
            // Reset dei campi
            document.getElementById('descr').value = "";
            document.getElementById('nome_utente').value = "";
            document.getElementById('tel_utente').value = "";
            document.getElementById('main-welcome').innerText = "Benvenuto";
        })
        .catch(e => {
            console.error(e);
            alert("Si è verificato un errore durante l'invio. Riprova.");
        });
    }
</script>

</body>
</html>






